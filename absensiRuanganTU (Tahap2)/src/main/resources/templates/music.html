<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Streaming - AbsensiKampus</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: #f8f8f8; color: #1a1a1a; min-height: 100vh; }
        .sidebar { position: fixed; left: 0; top: 0; width: 260px; height: 100vh; background: #0a0a0a; color: #fff; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { padding: 28px 24px; border-bottom: 1px solid rgba(255,255,255,0.08); }
        .sidebar-header .logo { display: flex; align-items: center; gap: 12px; }
        .sidebar-header .logo-icon { width: 40px; height: 40px; background: #fff; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .sidebar-header .logo-text { font-size: 16px; font-weight: 700; }
        .sidebar-header .logo-sub { font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 2px; }
        .sidebar-nav { padding: 16px 12px; flex: 1; overflow-y: auto; }
        .nav-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: rgba(255,255,255,0.35); padding: 8px 12px; margin-top: 8px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 11px 14px; border-radius: 8px; color: rgba(255,255,255,0.6); text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.2s; cursor: pointer; margin-bottom: 2px; }
        .nav-item:hover { background: rgba(255,255,255,0.08); color: #fff; }
        .nav-item.active { background: #fff; color: #0a0a0a; }
        .nav-item .nav-icon { width: 20px; text-align: center; font-size: 16px; }
        .sidebar-footer { padding: 20px 24px; border-top: 1px solid rgba(255,255,255,0.08); }
        .sidebar-footer .version { font-size: 11px; color: rgba(255,255,255,0.3); }
        .main-content { margin-left: 260px; min-height: 100vh; }
        .topbar { background: #fff; border-bottom: 1px solid #e5e5e5; padding: 0 36px; height: 64px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 50; }
        .topbar h1 { font-size: 20px; font-weight: 700; color: #0a0a0a; }
        .topbar-right { display: flex; align-items: center; gap: 12px; }
        .page-content { padding: 28px 36px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 28px; }
        .stat-card { background: #fff; border-radius: 12px; padding: 24px; border: 1px solid #e5e5e5; }
        .stat-card .stat-label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .stat-card .stat-value { font-size: 28px; font-weight: 800; color: #0a0a0a; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-header h2 { font-size: 18px; font-weight: 700; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-size: 13px; font-weight: 600; cursor: pointer; font-family: 'Inter', sans-serif; transition: all 0.2s; }
        .btn-primary { background: #0a0a0a; color: #fff; }
        .btn-primary:hover { background: #333; }
        .btn-secondary { background: #f0f0f0; color: #333; border: 1px solid #ddd; }
        .btn-secondary:hover { background: #e0e0e0; }
        .btn-danger { background: #ef4444; color: #fff; }
        .btn-danger:hover { background: #dc2626; }
        .btn-sm { padding: 6px 14px; font-size: 12px; }

        /* Music specific */
        .track-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; margin-bottom: 28px; }
        .track-card { background: #fff; border-radius: 14px; border: 1px solid #e5e5e5; overflow: hidden; transition: all 0.3s; cursor: pointer; }
        .track-card:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0,0,0,0.1); }
        .track-cover { width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; position: relative; }
        .track-cover .play-btn { width: 56px; height: 56px; background: rgba(255,255,255,0.95); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; opacity: 0; transition: all 0.3s; cursor: pointer; border: none; }
        .track-card:hover .play-btn { opacity: 1; }
        .track-cover .cover-icon { font-size: 60px; opacity: 0.3; position: absolute; }
        .track-info { padding: 16px; }
        .track-info .track-title { font-size: 15px; font-weight: 700; margin-bottom: 4px; color: #0a0a0a; }
        .track-info .track-artist { font-size: 13px; color: #888; margin-bottom: 8px; }
        .track-info .track-meta { display: flex; justify-content: space-between; align-items: center; }
        .track-info .track-genre { font-size: 11px; background: #f0f0f0; padding: 4px 10px; border-radius: 20px; color: #555; }
        .track-info .track-duration { font-size: 12px; color: #aaa; }
        .track-info .track-plays { font-size: 11px; color: #aaa; margin-top: 6px; }
        .genre-colors { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
        .genre-tag { padding: 6px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer; border: 1px solid #e5e5e5; background: #fff; transition: all 0.2s; }
        .genre-tag:hover, .genre-tag.active { background: #0a0a0a; color: #fff; border-color: #0a0a0a; }

        /* Player bar */
        .player-bar { position: fixed; bottom: 0; left: 260px; right: 0; height: 80px; background: #0a0a0a; color: #fff; display: flex; align-items: center; padding: 0 30px; gap: 24px; z-index: 200; display: none; }
        .player-bar.active { display: flex; }
        .player-info { display: flex; align-items: center; gap: 14px; min-width: 220px; }
        .player-thumb { width: 50px; height: 50px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .player-title { font-size: 14px; font-weight: 600; }
        .player-artist { font-size: 12px; color: rgba(255,255,255,0.5); }
        .player-controls { display: flex; align-items: center; gap: 20px; flex: 1; justify-content: center; }
        .player-btn { background: none; border: none; color: #fff; font-size: 20px; cursor: pointer; opacity: 0.7; transition: 0.2s; }
        .player-btn:hover { opacity: 1; }
        .player-btn.main { font-size: 36px; opacity: 1; }
        .player-progress { flex: 1; max-width: 400px; }
        .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; cursor: pointer; position: relative; }
        .progress-fill { height: 100%; background: #fff; border-radius: 2px; width: 0%; transition: width 0.1s; }
        .player-time { display: flex; justify-content: space-between; font-size: 11px; color: rgba(255,255,255,0.4); margin-top: 4px; }

        /* Playlist section */
        .playlist-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 28px; }
        .playlist-card { background: #fff; border-radius: 12px; border: 1px solid #e5e5e5; padding: 20px; cursor: pointer; transition: all 0.3s; }
        .playlist-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        .playlist-icon { font-size: 36px; margin-bottom: 12px; }
        .playlist-name { font-size: 15px; font-weight: 700; color: #0a0a0a; margin-bottom: 4px; }
        .playlist-count { font-size: 12px; color: #888; }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: #fff; border-radius: 16px; padding: 32px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        .modal h3 { font-size: 18px; font-weight: 700; margin-bottom: 20px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 6px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 14px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif; transition: border-color 0.2s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #0a0a0a; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .search-box { display: flex; align-items: center; gap: 8px; background: #f5f5f5; border: 1px solid #e5e5e5; border-radius: 8px; padding: 8px 14px; width: 280px; }
        .search-box input { border: none; background: none; outline: none; font-size: 13px; width: 100%; font-family: 'Inter', sans-serif; }
        .track-actions { display: flex; gap: 6px; margin-top: 8px; }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">&#127979;</div>
                <div>
                    <div class="logo-text">AbsensiKampus</div>
                    <div class="logo-sub">Monitoring System</div>
                </div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-label">Menu Utama</div>
            <a class="nav-item" href="/"><span class="nav-icon">&#9632;</span><span>Dashboard</span></a>
            <div class="nav-label" style="margin-top:24px;">Fitur Lainnya</div>
            <a class="nav-item" href="/property"><span class="nav-icon">&#127968;</span><span>Real Estate</span></a>
            <a class="nav-item" href="/project"><span class="nav-icon">&#128203;</span><span>Project Management</span></a>
            <a class="nav-item" href="/chatbot"><span class="nav-icon">&#129302;</span><span>Chatbot</span></a>
            <a class="nav-item active" href="/music"><span class="nav-icon">&#127925;</span><span>Music Streaming</span></a>
            <a class="nav-item" href="/expense"><span class="nav-icon">&#128176;</span><span>Expense Report</span></a>
            <a class="nav-item" href="/language"><span class="nav-icon">&#127760;</span><span>Language Learning</span></a>
        </nav>
        <div class="sidebar-footer">
            <div class="version">Absensi Ruangan TU v2.0</div>
        </div>
    </aside>

    <div class="main-content">
        <div class="topbar">
            <h1>&#127925; Music Streaming</h1>
            <div class="topbar-right">
                <div class="search-box">
                    <span>&#128269;</span>
                    <input type="text" id="searchInput" placeholder="Cari lagu, artis, album..." oninput="searchTracks()">
                </div>
            </div>
        </div>

        <div class="page-content" style="padding-bottom: 100px;">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Lagu</div>
                    <div class="stat-value" th:text="${totalTracks}">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Playlist</div>
                    <div class="stat-value" th:text="${totalPlaylists}">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Genre</div>
                    <div class="stat-value" th:text="${genres.size()}">0</div>
                </div>
            </div>

            <!-- Genre Filter -->
            <div class="genre-colors">
                <span class="genre-tag active" onclick="filterGenre('')">Semua</span>
                <span class="genre-tag" th:each="g : ${genres}" th:text="${g}" th:data-genre="${g}" onclick="filterGenre(this.dataset.genre)"></span>
            </div>

            <!-- Tracks -->
            <div class="section-header">
                <h2>&#127926; Daftar Lagu</h2>
                <button class="btn btn-primary" onclick="showAddTrack()">+ Tambah Lagu</button>
            </div>
            <div class="track-grid" id="trackGrid">
                <div class="track-card" th:each="track : ${tracks}" th:data-id="${track.idTrack}">
                    <div class="track-cover" th:style="'background: linear-gradient(135deg, ' + ${#strings.isEmpty(track.coverUrl) ? '#667eea 0%, #764ba2 100%' : '#667eea 0%, #764ba2 100%'} + ')'">
                        <span class="cover-icon">&#127925;</span>
                        <button class="play-btn" th:data-id="${track.idTrack}" onclick="playTrack(parseInt(this.dataset.id))">&#9654;</button>
                    </div>
                    <div class="track-info">
                        <div class="track-title" th:text="${track.judul}">Song Title</div>
                        <div class="track-artist" th:text="${track.artist}">Artist</div>
                        <div class="track-meta">
                            <span class="track-genre" th:text="${track.genre}">Pop</span>
                            <span class="track-duration" th:text="${track.durasiFormatted}">3:45</span>
                        </div>
                        <div class="track-plays">&#9654; <span th:text="${track.playCount}">0</span> plays</div>
                        <div class="track-actions">
                            <button class="btn btn-secondary btn-sm" th:data-id="${track.idTrack}" onclick="editTrack(parseInt(this.dataset.id))">Edit</button>
                            <button class="btn btn-danger btn-sm" th:data-id="${track.idTrack}" onclick="deleteTrack(parseInt(this.dataset.id))">Hapus</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Playlists -->
            <div class="section-header">
                <h2>&#128214; Playlist</h2>
                <button class="btn btn-primary" onclick="showAddPlaylist()">+ Buat Playlist</button>
            </div>
            <div class="playlist-grid" id="playlistGrid">
                <div class="playlist-card" th:each="pl : ${playlists}" th:data-id="${pl.idPlaylist}" onclick="viewPlaylist(parseInt(this.dataset.id))">
                    <div class="playlist-icon">&#127926;</div>
                    <div class="playlist-name" th:text="${pl.namaPlaylist}">My Playlist</div>
                    <div class="playlist-count"><span th:text="${pl.totalTracks}">0</span> lagu</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Bar -->
    <div class="player-bar" id="playerBar">
        <div class="player-info">
            <div class="player-thumb">&#127925;</div>
            <div>
                <div class="player-title" id="playerTitle">-</div>
                <div class="player-artist" id="playerArtist">-</div>
            </div>
        </div>
        <div class="player-controls">
            <button class="player-btn" onclick="prevTrack()">&#9198;</button>
            <button class="player-btn main" id="playPauseBtn" onclick="togglePlay()">&#9654;</button>
            <button class="player-btn" onclick="nextTrack()">&#9197;</button>
        </div>
        <div class="player-progress">
            <div class="progress-bar" onclick="seekTo(event)">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="player-time">
                <span id="currentTime">0:00</span>
                <span id="totalTime">0:00</span>
            </div>
        </div>
    </div>

    <!-- Add Track Modal -->
    <div class="modal-overlay" id="trackModal">
        <div class="modal">
            <h3 id="trackModalTitle">Tambah Lagu Baru</h3>
            <input type="hidden" id="editTrackId">
            <div class="form-group">
                <label>Judul Lagu *</label>
                <input type="text" id="trackJudul" placeholder="Masukkan judul lagu">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Artist *</label>
                    <input type="text" id="trackArtist" placeholder="Nama artis">
                </div>
                <div class="form-group">
                    <label>Album</label>
                    <input type="text" id="trackAlbum" placeholder="Nama album">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Genre *</label>
                    <select id="trackGenre">
                        <option value="Pop">Pop</option>
                        <option value="Rock">Rock</option>
                        <option value="Jazz">Jazz</option>
                        <option value="R&B">R&B</option>
                        <option value="Hip Hop">Hip Hop</option>
                        <option value="Electronic">Electronic</option>
                        <option value="Classical">Classical</option>
                        <option value="Dangdut">Dangdut</option>
                        <option value="Keroncong">Keroncong</option>
                        <option value="Indie">Indie</option>
                        <option value="K-Pop">K-Pop</option>
                        <option value="J-Pop">J-Pop</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Durasi (detik) *</label>
                    <input type="number" id="trackDurasi" placeholder="210" min="1">
                </div>
            </div>
            <div class="form-group">
                <label>File URL</label>
                <input type="text" id="trackFileUrl" placeholder="https://example.com/song.mp3">
            </div>
            <div class="form-group">
                <label>Cover URL</label>
                <input type="text" id="trackCoverUrl" placeholder="https://example.com/cover.jpg">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('trackModal')">Batal</button>
                <button class="btn btn-primary" onclick="saveTrack()">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Playlist Modal -->
    <div class="modal-overlay" id="playlistModal">
        <div class="modal">
            <h3>Buat Playlist Baru</h3>
            <div class="form-group">
                <label>Nama Playlist *</label>
                <input type="text" id="plName" placeholder="Nama playlist">
            </div>
            <div class="form-group">
                <label>Deskripsi</label>
                <textarea id="plDesc" rows="3" placeholder="Deskripsi playlist"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('playlistModal')">Batal</button>
                <button class="btn btn-primary" onclick="savePlaylist()">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        let allTracks = [];
        let currentTrackIndex = -1;
        let isPlaying = false;

        // Load tracks data from Thymeleaf
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/music/api/tracks')
                .then(r => r.json())
                .then(data => { allTracks = data; });
        });

        function showAddTrack() {
            document.getElementById('trackModalTitle').textContent = 'Tambah Lagu Baru';
            document.getElementById('editTrackId').value = '';
            document.getElementById('trackJudul').value = '';
            document.getElementById('trackArtist').value = '';
            document.getElementById('trackAlbum').value = '';
            document.getElementById('trackGenre').value = 'Pop';
            document.getElementById('trackDurasi').value = '';
            document.getElementById('trackFileUrl').value = '';
            document.getElementById('trackCoverUrl').value = '';
            document.getElementById('trackModal').classList.add('show');
        }

        function editTrack(id) {
            fetch('/music/api/tracks/' + id)
                .then(r => r.json())
                .then(track => {
                    document.getElementById('trackModalTitle').textContent = 'Edit Lagu';
                    document.getElementById('editTrackId').value = track.idTrack;
                    document.getElementById('trackJudul').value = track.judul;
                    document.getElementById('trackArtist').value = track.artist;
                    document.getElementById('trackAlbum').value = track.album || '';
                    document.getElementById('trackGenre').value = track.genre;
                    document.getElementById('trackDurasi').value = track.durasi;
                    document.getElementById('trackFileUrl').value = track.fileUrl || '';
                    document.getElementById('trackCoverUrl').value = track.coverUrl || '';
                    document.getElementById('trackModal').classList.add('show');
                });
        }

        function saveTrack() {
            const id = document.getElementById('editTrackId').value;
            const data = {
                judul: document.getElementById('trackJudul').value,
                artist: document.getElementById('trackArtist').value,
                album: document.getElementById('trackAlbum').value,
                genre: document.getElementById('trackGenre').value,
                durasi: parseInt(document.getElementById('trackDurasi').value),
                fileUrl: document.getElementById('trackFileUrl').value,
                coverUrl: document.getElementById('trackCoverUrl').value
            };
            if (!data.judul || !data.artist || !data.durasi) { alert('Judul, Artist, dan Durasi wajib diisi!'); return; }
            if (id) data.idTrack = parseInt(id);

            const url = id ? '/music/api/tracks/update' : '/music/api/tracks/add';
            fetch(url, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(data) })
                .then(r => r.json())
                .then(res => { if (res.success) { location.reload(); } else { alert(res.message); } })
                .catch(e => alert('Error: ' + e));
        }

        function deleteTrack(id) {
            if (!confirm('Hapus lagu ini?')) return;
            fetch('/music/api/tracks/delete', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({idTrack: id}) })
                .then(r => r.json())
                .then(res => { if (res.success) location.reload(); else alert(res.message); });
        }

        function playTrack(id) {
            const track = allTracks.find(t => t.idTrack === id);
            if (!track) return;
            currentTrackIndex = allTracks.indexOf(track);
            document.getElementById('playerTitle').textContent = track.judul;
            document.getElementById('playerArtist').textContent = track.artist;
            document.getElementById('totalTime').textContent = track.durasiFormatted || formatDuration(track.durasi);
            document.getElementById('playerBar').classList.add('active');
            document.getElementById('playPauseBtn').innerHTML = '&#9646;&#9646;';
            isPlaying = true;
            fetch('/music/api/tracks/play/' + id, { method: 'POST' });
            simulateProgress(track.durasi);
        }

        function formatDuration(sec) { return Math.floor(sec/60) + ':' + String(sec%60).padStart(2, '0'); }

        let progressInterval;
        let currentSec = 0;
        function simulateProgress(totalSec) {
            clearInterval(progressInterval);
            currentSec = 0;
            progressInterval = setInterval(() => {
                if (!isPlaying) return;
                currentSec++;
                const pct = (currentSec / totalSec) * 100;
                document.getElementById('progressFill').style.width = pct + '%';
                document.getElementById('currentTime').textContent = formatDuration(currentSec);
                if (currentSec >= totalSec) { clearInterval(progressInterval); nextTrack(); }
            }, 1000);
        }

        function togglePlay() {
            isPlaying = !isPlaying;
            document.getElementById('playPauseBtn').innerHTML = isPlaying ? '&#9646;&#9646;' : '&#9654;';
        }

        function nextTrack() {
            if (allTracks.length === 0) return;
            currentTrackIndex = (currentTrackIndex + 1) % allTracks.length;
            playTrack(allTracks[currentTrackIndex].idTrack);
        }

        function prevTrack() {
            if (allTracks.length === 0) return;
            currentTrackIndex = (currentTrackIndex - 1 + allTracks.length) % allTracks.length;
            playTrack(allTracks[currentTrackIndex].idTrack);
        }

        function searchTracks() {
            const keyword = document.getElementById('searchInput').value;
            if (keyword.length < 1) { location.reload(); return; }
            fetch('/music/api/tracks/search?keyword=' + encodeURIComponent(keyword))
                .then(r => r.json())
                .then(tracks => renderTracks(tracks));
        }

        function filterGenre(genre) {
            document.querySelectorAll('.genre-tag').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            if (!genre) { location.reload(); return; }
            fetch('/music/api/tracks/genre/' + encodeURIComponent(genre))
                .then(r => r.json())
                .then(tracks => renderTracks(tracks));
        }

        function renderTracks(tracks) {
            const grid = document.getElementById('trackGrid');
            grid.innerHTML = tracks.map(t => `
                <div class="track-card" data-id="${t.idTrack}">
                    <div class="track-cover"><span class="cover-icon">&#127925;</span>
                        <button class="play-btn" onclick="playTrack(${t.idTrack})">&#9654;</button></div>
                    <div class="track-info">
                        <div class="track-title">${t.judul}</div>
                        <div class="track-artist">${t.artist}</div>
                        <div class="track-meta"><span class="track-genre">${t.genre||''}</span><span class="track-duration">${t.durasiFormatted||formatDuration(t.durasi)}</span></div>
                        <div class="track-plays">&#9654; ${t.playCount} plays</div>
                        <div class="track-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editTrack(${t.idTrack})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteTrack(${t.idTrack})">Hapus</button>
                        </div>
                    </div>
                </div>`).join('');
        }

        function showAddPlaylist() { document.getElementById('plName').value = ''; document.getElementById('plDesc').value = ''; document.getElementById('playlistModal').classList.add('show'); }

        function savePlaylist() {
            const data = { namaPlaylist: document.getElementById('plName').value, deskripsi: document.getElementById('plDesc').value };
            if (!data.namaPlaylist) { alert('Nama playlist wajib diisi!'); return; }
            fetch('/music/api/playlists/add', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(data) })
                .then(r => r.json())
                .then(res => { if (res.success) location.reload(); else alert(res.message); });
        }

        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
        document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', function(e) { if (e.target === this) this.classList.remove('show'); }));
    </script>
</body>
</html>
